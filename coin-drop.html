<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coin Drop Game</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: Arial, sans-serif;
        }
        
        #gameCanvas {
            border: 3px solid #333;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            cursor: crosshair;
        }
        
        .mega-counter {
            margin-bottom: 15px;
            padding: 15px 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-size: 24px;
            font-weight: bold;
            color: #FF0000;
        }
        
        .info {
            margin-top: 20px;
            padding: 15px 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        .info h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .coin-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }
        
        .coin-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }
        
        .coin-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 1px solid #333;
        }
    </style>
</head>
<body>
    <div class="mega-counter">Mega Coins: <span id="megaCount">0</span></div>
    <canvas id="gameCanvas" width="480" height="360"></canvas>
    <div class="info">
        <h3>Click anywhere to drop coins! Match two of the same type to merge them!</h3>
        <div class="coin-legend">
            <div class="coin-item">
                <div class="coin-color" style="background: #40B0B0;"></div>
                <span>Dime</span>
            </div>
            <div class="coin-item">
                <div class="coin-color" style="background: #FF0000;"></div>
                <span>Cent</span>
            </div>
            <div class="coin-item">
                <div class="coin-color" style="background: #C0C0C0;"></div>
                <span>Silver Eagle</span>
            </div>
            <div class="coin-item">
                <div class="coin-color" style="background: #FFD700;"></div>
                <span>Gold Coin</span>
            </div>
            <div class="coin-item">
                <div class="coin-color" style="background: #B87333;"></div>
                <span>Standing Liberty</span>
            </div>
            <div class="coin-item">
                <div class="coin-color" style="background: #B0B0B0;"></div>
                <span>Walking Liberty</span>
            </div>
            <div class="coin-item">
                <div class="coin-color" style="background: #B0B080;"></div>
                <span>Franklin Half</span>
            </div>
            <div class="coin-item">
                <div class="coin-color" style="background: #E5E4E2;"></div>
                <span>Platinum Eagle</span>
            </div>
            <div class="coin-item">
                <div class="coin-color" style="background: #FF0000;"></div>
                <span>Mega Coin!</span>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        const COLORS = {
            'dime': '#40B0B0',
            'cent': '#FF0000',
            'silver eagle': '#C0C0C0',
            'gold coin': '#FFD700',
            'standing Liberty': '#B87333',
            'walking liberty': '#B0B0B0',
            'franklin half': '#B0B080',
            'platinum eagle': '#E5E4E2',
            'mega coin': '#FF0000'
        };
        
        const SIZES = {
            'dime': 15,
            'cent': 20,
            'silver eagle': 30,
            'gold coin': 40,
            'standing Liberty': 50,
            'walking liberty': 60,
            'franklin half': 65,
            'platinum eagle': 70,
            'mega coin': 150
        };
        
        const FUSION_RULES = {
            'dime+dime': 'cent',
            'cent+cent': 'silver eagle',
            'silver eagle+silver eagle': 'gold coin',
            'gold coin+gold coin': 'standing Liberty',
            'standing Liberty+standing Liberty': 'walking liberty',
            'walking liberty+walking liberty': 'franklin half',
            'franklin half+franklin half': 'platinum eagle'
        };
        
        class Coin {
            constructor(type, x, y, id) {
                this.type = type;
                this.x = x;
                this.y = y;
                this.id = id;
                this.xChange = 0;
                this.yChange = 0;
                this.radius = SIZES[type];
                this.toRemove = false;
            }
            
            update() {
                // Apply gravity
                this.yChange -= 0.5;
                
                // Update position
                this.x += this.xChange;
                this.y += this.yChange;
                
                // Bounce off edges
                if (this.x < -240 + this.radius) {
                    this.x = -240 + this.radius;
                    this.xChange = Math.abs(this.xChange) * 0.8;
                } else if (this.x > 240 - this.radius) {
                    this.x = 240 - this.radius;
                    this.xChange = -Math.abs(this.xChange) * 0.8;
                }
                
                if (this.y < -180 + this.radius) {
                    this.y = -180 + this.radius;
                    this.yChange = Math.abs(this.yChange) * 0.8;
                }
                
                // Apply stronger damping to reduce vibration
                this.xChange *= 0.90;
                this.yChange *= 0.97;
                
                // Stop very small movements to prevent endless vibration
                if (Math.abs(this.xChange) < 0.05) this.xChange = 0;
                if (Math.abs(this.yChange) < 0.05) this.yChange = 0;
            }
            
            draw() {
                const px = this.x + 240;
                const py = 180 - this.y;
                
                ctx.beginPath();
                ctx.arc(px, py, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = COLORS[this.type];
                ctx.fill();
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Add shine effect for mega coin
                if (this.type === 'mega coin') {
                    ctx.beginPath();
                    ctx.arc(px - this.radius/3, py - this.radius/3, this.radius/3, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                    ctx.fill();
                }
            }
        }
        
        class CoinSimulator {
            constructor() {
                this.coins = [];
                this.nextId = 1;
                this.megaCoinsCount = 0;
                this.setupEventListeners();
                this.animate();
            }
            
            setupEventListeners() {
                canvas.addEventListener('click', (e) => {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left - 240;
                    const y = 180 - (e.clientY - rect.top);
                    
                    this.coins.push(new Coin('dime', x, y, this.nextId++));
                });
            }
            
            checkCollisions() {
                const coinsToRemove = new Set();
                const coinsToAdd = [];
                
                for (let i = 0; i < this.coins.length; i++) {
                    if (coinsToRemove.has(this.coins[i])) continue;
                    
                    for (let j = i + 1; j < this.coins.length; j++) {
                        if (coinsToRemove.has(this.coins[j])) continue;
                        
                        const coin = this.coins[i];
                        const other = this.coins[j];
                        
                        const dx = coin.x - other.x;
                        const dy = coin.y - other.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        const minDistance = coin.radius + other.radius;
                        
                        if (distance < minDistance) {
                            const fusionKey = `${coin.type}+${other.type}`;
                            const fusionKeyReverse = `${other.type}+${coin.type}`;
                            
                            if (FUSION_RULES[fusionKey] || FUSION_RULES[fusionKeyReverse]) {
                                const newType = FUSION_RULES[fusionKey] || FUSION_RULES[fusionKeyReverse];
                                
                                const newX = (coin.x + other.x) / 2;
                                const newY = (coin.y + other.y) / 2;
                                
                                const newCoin = new Coin(newType, newX, newY, this.nextId++);
                                newCoin.xChange = (coin.xChange + other.xChange) / 2;
                                newCoin.yChange = (coin.yChange + other.yChange) / 2;
                                
                                coinsToRemove.add(coin);
                                coinsToRemove.add(other);
                                coinsToAdd.push(newCoin);
                                break;
                            } else {
                                // Normal collision
                                const angle = Math.atan2(dy, dx);
                                const overlap = minDistance - distance;
                                
                                if (distance > 0) {
                                    coin.x += (dx / distance) * overlap * 0.5;
                                    coin.y += (dy / distance) * overlap * 0.5;
                                    other.x -= (dx / distance) * overlap * 0.5;
                                    other.y -= (dy / distance) * overlap * 0.5;
                                }
                                
                                coin.xChange += Math.cos(angle) * 1.5;
                                coin.yChange += Math.sin(angle) * 1.5;
                                other.xChange -= Math.cos(angle) * 1.5;
                                other.yChange -= Math.sin(angle) * 1.5;
                            }
                        }
                    }
                }
                
                // Check for mega coin creation
                const platinumCoins = this.coins.filter(c => c.type === 'platinum eagle' && !coinsToRemove.has(c));
                if (platinumCoins.length >= 2) {
                    const coin1 = platinumCoins[0];
                    const coin2 = platinumCoins[1];
                    
                    const newX = (coin1.x + coin2.x) / 2;
                    const newY = (coin1.y + coin2.y) / 2;
                    const megaCoin = new Coin('mega coin', newX, newY, this.nextId++);
                    megaCoin.xChange = (coin1.xChange + coin2.xChange) / 2;
                    megaCoin.yChange = (coin1.yChange + coin2.yChange) / 2;
                    
                    coinsToRemove.add(coin1);
                    coinsToRemove.add(coin2);
                    coinsToAdd.push(megaCoin);
                    
                    // Increment mega coin counter
                    this.megaCoinsCount++;
                    document.getElementById('megaCount').textContent = this.megaCoinsCount;
                    
                    setTimeout(() => {
                        const index = this.coins.indexOf(megaCoin);
                        if (index > -1) {
                            this.coins.splice(index, 1);
                        }
                    }, 2000);
                }
                
                this.coins = this.coins.filter(c => !coinsToRemove.has(c));
                this.coins.push(...coinsToAdd);
            }
            
            animate() {
                // Update all coins
                this.coins.forEach(coin => coin.update());
                
                // Check collisions
                this.checkCollisions();
                
                // Clear canvas
                ctx.fillStyle = '#87CEEB';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Draw all coins
                this.coins.forEach(coin => coin.draw());
                
                requestAnimationFrame(() => this.animate());
            }
        }
        
        // Start the game
        new CoinSimulator();
    </script>
</body>
</html>