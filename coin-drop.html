

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coin Drop Game</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: Arial, sans-serif;
        }
        
        #gameCanvas {
            border: 3px solid #333;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            cursor: crosshair;
        }
        
        .mega-counter {
            margin-bottom: 15px;
            padding: 15px 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-size: 24px;
            font-weight: bold;
            color: #FF0000;
        }
        .bank-bonus {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: 3px solid #FF8C00;
            border-radius: 8px;
            font-weight: bold;
            color: #000;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255,140,0,0.5);
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .bank-bonus:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(255,140,0,0.7);
        }
        
        .bank-bonus.active {
            background: linear-gradient(135deg, #00FF00, #00CC00);
            border-color: #009900;
            animation: pulse 0.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .bank-bonus.hidden {
            display: none;
        }
        
        .info {
            margin-top: 20px;
            padding: 15px 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        .info h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .coin-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }
        
        .coin-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }
        
        .coin-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 1px solid #333;
        }
        .highlight{
            background-color: yellow;
        }
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 40px 60px;
            border-radius: 20px;
            text-align: center;
            font-size: 48px;
            font-weight: bold;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 20;
            display: none;
        }
        
        .game-over.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
        
        .game-over button {
            margin-top: 20px;
            padding: 15px 30px;
            font-size: 24px;
            background: #FFD700;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .game-over button:hover {
            background: #FFA500;
            transform: scale(1.1);
        }
        #warning{
            background-color: red;
        }
         .upgrade-bonus {
            position: absolute;
            top: 70px;
            right: 10px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #9C27B0, #E91E63);
            border: 3px solid #880E4F;
            border-radius: 8px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(136,14,79,0.5);
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .upgrade-bonus:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(136,14,79,0.7);
        }
        
        .upgrade-bonus.active {
            background: linear-gradient(135deg, #00FF00, #00CC00);
            border-color: #009900;
            animation: pulse 0.5s infinite;
        }
        
        .upgrade-bonus.hidden {
            display: none;
        }
        .hidden{
            display: none;
        }
        .highlight{
            animation: pulse 0.5s infinite;
        }
    </style>
</head>
<body>
    <div class="mega-counter">Mega Coins: <span id="megaCount">0</span></div>
    <div class="score">Score: <span id="score">0</span>%</div>
    High Score:
    <svg height="32px" width="32px" viewBox="0 0 16 16" fill="none" aria-hidden="true" aria-labelledby=":r54:" class="loading">
        <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-opacity="0.25" stroke-width="2" vector-effect="non-scaling-stroke"></circle>
        <path d="M15 8a7.002 7.002 0 00-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" vector-effect="non-scaling-stroke"></path>
    </svg>
    <span id="max"></span>
    <script>
    let spinner1 = document.getElementsByClassName('loading')[0];
    let rotateAmount = 0;
    setInterval(() => {
        if (rotateAmount == 360) {
            rotateAmount = 1
        } else {
            rotateAmount++
        }
        spinner1.style.transform = `rotate(${rotateAmount}deg)`
    }, 5);
    </script>
    <canvas id="gameCanvas" width="480" height="360"></canvas>
    <noscript>
        This game uses JavaScript to animate and render the coins and game canvas. Please enable JavaScript to play...
    </noscript>
    <div id="bankBonus" class="bank-bonus hidden">üè¶ Bank Bonus<br><small>Click to Remove a Coin</small></div>
    <div id="upgradeBonus" class="upgrade-bonus hidden">‚¨ÜÔ∏è Upgrade Bonus<br><small>Drop to Upgrade a Coin</small></div>

    <div id="gameOver" class="game-over">
            <div>GAME OVER!</div>
            <div style="font-size: 24px; margin-top: 10px;">Coins reached the top!</div>
            <button onclick="location.reload()">Play Again</button>
        </div>
    <div>
        <span id="warning"></span>
    </div>
    <div class="info">
        <h3>Click anywhere to drop coins! Match two of the same type to merge them!</h3>
        <h3>The `Bank Bonus` removes a coin.</h3>
        <h3>When a coin reaches the top, the game ends...</h3>
        <div class="coin-legend">
            <div class="coin-item" id="1">
                <div class="coin-color" style="background: #40B0B0;"></div>
                <span>Dime</span>
            </div>
            <div class="coin-item"id="2">
                <div class="coin-color" style="background: #FF0000;"></div>
                <span>Cent</span>
            </div>
            <div class="coin-item" id="3">
                <div class="coin-color" style="background: #C0C0C0;"></div>
                <span>Silver Eagle</span>
            </div>
            <div class="coin-item">
                <div class="coin-color" style="background: #FFD700;"></div>
                <span>Gold Coin</span>
            </div>
            <div class="coin-item">
                <div class="coin-color" style="background: #B87333;"></div>
                <span>Standing Liberty</span>
            </div>
            <div class="coin-item">
                <div class="coin-color" style="background: #B0B0B0;"></div>
                <span>Walking Liberty</span>
            </div>
            <div class="coin-item">
                <div class="coin-color" style="background: #B0B080;"></div>
                <span>Franklin Half</span>
            </div>
            <div class="coin-item">
                <div class="coin-color" style="background: #E5E4E2;"></div>
                <span>Platinum Eagle</span>
            </div>
            <div class="coin-item" id="mega">
                <div class="coin-color" style="background: #FF0000;"></div>
                <span>Mega Coin!</span>
            </div>
        </div>
    </div>

    <script>

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const RANKS = {
            0 : 'dime',
            1 : 'cent',
            2 : 'silver eagle',
        };
        const COLORS = {
            'dime': '#40B0B0',
            'cent': '#FF0000',
            'silver eagle': '#C0C0C0',
            'gold coin': '#FFD700',
            'standing Liberty': '#B87333',
            'walking liberty': '#B0B0B0',
            'franklin half': '#B0B080',
            'platinum eagle': '#E5E4E2',
            'mega coin': '#FF0000'
        };
        
        const SIZES = {
            'dime': 15,
            'cent': 20,
            'silver eagle': 30,
            'gold coin': 40,
            'standing Liberty': 50,
            'walking liberty': 60,
            'franklin half': 65,
            'platinum eagle': 70,
            'mega coin': 150
        };
        
        const FUSION_RULES = {
            'dime+dime': 'cent',
            'cent+cent': 'silver eagle',
            'silver eagle+silver eagle': 'gold coin',
            'gold coin+gold coin': 'standing Liberty',
            'standing Liberty+standing Liberty': 'walking liberty',
            'walking liberty+walking liberty': 'franklin half',
            'franklin half+franklin half': 'platinum eagle'
        };
        const UPGRADE_MAP = {
            'dime': 'cent',
            'cent': 'silver eagle',
            'silver eagle': 'gold coin',
            'gold coin': 'standing Liberty',
            'standing Liberty': 'walking liberty',
            'walking liberty': 'franklin half',
            'franklin half': 'platinum eagle',
            'platinum eagle': 'platinum eagle' // Max level
        };
        const VALUES = {
            'dime': 0.2,
            'cent': 0.5,
            'silver eagle': 1.1,
            'gold coin': 3.2,
            'standing Liberty': 6.3,
            'walking liberty': 12.5,
            'franklin half': 25,
            'platinum eagle': 50,
            'mega coin': 100,
        };
        class Coin {
            constructor(type, x, y, id, isUpgradeBonus = false) {
                this.type = type;
                this.x = x;
                this.y = y;
                this.id = id;
                this.xChange = 0;
                this.yChange = 0;
                this.radius = SIZES[type];
                this.isUpgradeBonus = isUpgradeBonus;
            }
            
            update() {
                this.yChange -= 0.5;
                this.x += this.xChange;
                this.y += this.yChange;
                
                if (this.x < -240 + this.radius) {
                    this.x = -240 + this.radius;
                    this.xChange = Math.abs(this.xChange) * 0.8;
                } else if (this.x > 240 - this.radius) {
                    this.x = 240 - this.radius;
                    this.xChange = -Math.abs(this.xChange) * 0.8;
                }
                
                if (this.y < -180 + this.radius) {
                    this.y = -180 + this.radius;
                    this.yChange = Math.abs(this.yChange) * 0.8;
                }
                
                this.xChange *= 0.95;
                this.yChange *= 0.95;
                
                if (Math.abs(this.xChange) < 0.01) this.xChange = 0;
                if (Math.abs(this.yChange) < 0.01) this.yChange = 0;
            }
            
            draw() {
                const px = this.x + 240;
                const py = 180 - this.y;
                
                ctx.beginPath();
                ctx.arc(px, py, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = COLORS[this.type];
                ctx.fill();
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                if (this.isUpgradeBonus) {
                    ctx.beginPath();
                    ctx.arc(px, py, this.radius, 0, Math.PI * 2);
                    ctx.strokeStyle = '#FF00FF';
                    ctx.lineWidth = 4;
                    ctx.stroke();
                    
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                    ctx.beginPath();
                    ctx.arc(px - this.radius/3, py - this.radius/3, this.radius/4, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                if (this.type === 'mega coin') {
                    ctx.beginPath();
                    ctx.arc(px - this.radius/3, py - this.radius/3, this.radius/3, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                    ctx.fill();
                }
            }
        }
        
        class CoinSimulator {
            constructor() {
                this.coins = [];
                this.nextId = 1;
                this.megaCoinsCount = 0;
                this.bankBonusActive = false;
                this.upgradeBonusActive = false;
                this.gameOver = false;
                this.topWarningTimer = null;
                this.nextCoin = 'dime';
                this.score = 0;
                this.bbAvail = 0;
                this.ubAvail = 0;
                this.setupEventListeners();
                this.animate();
            }
            
            setupEventListeners() {
                canvas.addEventListener('click', (e) => {
                    if (this.gameOver) return;
                    
                    const rect = canvas.getBoundingClientRect();
                    const clickX = e.clientX - rect.left;
                    const clickY = e.clientY - rect.top;
                    const x = clickX - 240;
                    const y = 150;
                    
                    if (this.bankBonusActive) {
                        this.removeCoinAtPosition(clickX, clickY);
                        this.bbAvail = 0
                    } else if (this.upgradeBonusActive) {
                        const upgradeCoin = new Coin('dime', x, y, this.nextId++, true);
                        this.coins.push(upgradeCoin);
                        this.upgradeBonusActive = false;
                        document.getElementById('upgradeBonus').classList.add('hidden');
                        document.getElementById('upgradeBonus').classList.remove('active');
                        this.ubAvail = 0;
                        canvas.style.cursor = 'crosshair';
                    } else {
                        this.coins.push(new Coin(this.nextCoin, x, y, this.nextId++));
                        this.nextCoin = RANKS[Math.floor(Math.random() * 3)];
                    }
                });
                
                document.getElementById('bankBonus').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.bankBonusActive = !this.bankBonusActive;
                    const btn = document.getElementById('bankBonus');
                    if (this.bankBonusActive) {
                        btn.classList.add('active');
                        canvas.style.cursor = 'pointer';
                        if (this.upgradeBonusActive) {
                            this.upgradeBonusActive = false;
                            document.getElementById('upgradeBonus').classList.remove('active');
                        }
                    } else {
                        btn.classList.remove('active');
                        canvas.style.cursor = 'crosshair';
                    }
                });
                
                document.getElementById('upgradeBonus').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.upgradeBonusActive = !this.upgradeBonusActive;
                    const btn = document.getElementById('upgradeBonus');
                    if (this.upgradeBonusActive) {
                        btn.classList.add('active');
                        canvas.style.cursor = 'crosshair';
                        if (this.bankBonusActive) {
                            this.bankBonusActive = false;
                            document.getElementById('bankBonus').classList.remove('active');
                        }
                    } else {
                        btn.classList.remove('active');
                        canvas.style.cursor = 'crosshair';
                    }
                });
            }
            removeCoinAtPosition(clickX, clickY) {
                let closestCoin = null;
                let closestDistance = Infinity;
                
                for (const coin of this.coins) {
                    const coinPx = coin.x + 240;
                    const coinPy = 180 - coin.y;
                    const dx = coinPx - clickX;
                    const dy = coinPy - clickY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < closestDistance) {
                        closestDistance = distance;
                        closestCoin = coin;
                    }
                }
                
                if (closestCoin) {
                    const index = this.coins.indexOf(closestCoin);
                    if (index > -1) {
                        this.coins.splice(index, 1);
                        this.bankBonusActive = false;
                        document.getElementById('bankBonus').classList.add('hidden');
                        document.getElementById('bankBonus').classList.remove('active');
                        canvas.style.cursor = 'crosshair';
                    }
                }
            }
            
            checkCollisions() {
                const coinsToRemove = new Set();
                const coinsToAdd = [];
                
                for (let i = 0; i < this.coins.length; i++) {
                    if (coinsToRemove.has(this.coins[i])) continue;
                    
                    for (let j = i + 1; j < this.coins.length; j++) {
                        if (coinsToRemove.has(this.coins[j])) continue;
                        
                        const coin = this.coins[i];
                        const other = this.coins[j];
                        
                        const dx = coin.x - other.x;
                        const dy = coin.y - other.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        const minDistance = coin.radius + other.radius;
                        
                        if (distance < minDistance) {
                            if (coin.isUpgradeBonus && !other.isUpgradeBonus) {
                                const newType = UPGRADE_MAP[other.type];
                                const newCoin = new Coin(newType, other.x, other.y, this.nextId++);
                                newCoin.xChange = other.xChange;
                                newCoin.yChange = other.yChange;
                                coinsToRemove.add(coin);
                                coinsToRemove.add(other);
                                coinsToAdd.push(newCoin);
                                break;
                            } else if (other.isUpgradeBonus && !coin.isUpgradeBonus) {
                                const newType = UPGRADE_MAP[coin.type];
                                const newCoin = new Coin(newType, coin.x, coin.y, this.nextId++);
                                newCoin.xChange = coin.xChange;
                                newCoin.yChange = coin.yChange;
                                coinsToRemove.add(coin);
                                coinsToRemove.add(other);
                                coinsToAdd.push(newCoin);
                                break;
                            } else {
                                const fusionKey = `${coin.type}+${other.type}`;
                                const fusionKeyReverse = `${other.type}+${coin.type}`;
                                
                                if (FUSION_RULES[fusionKey] || FUSION_RULES[fusionKeyReverse]) {
                                    const newType = FUSION_RULES[fusionKey] || FUSION_RULES[fusionKeyReverse];
                                    const newX = (coin.x + other.x) / 2;
                                    const newY = (coin.y + other.y) / 2;
                                    const newCoin = new Coin(newType, newX, newY, this.nextId++);
                                    newCoin.xChange = (coin.xChange + other.xChange) / 2;
                                    newCoin.yChange = (coin.yChange + other.yChange) / 2;
                                    coinsToRemove.add(coin);
                                    coinsToRemove.add(other);
                                    coinsToAdd.push(newCoin);
                                    this.score += VALUES[newType];
                                    this.bbAvail += VALUES[newType];
                                    this.ubAvail += VALUES[newType];
                                    this.score.toFixed(1)
                                    break;
                                } else {
                                    const angle = Math.atan2(dy, dx);
                                    const overlap = minDistance - distance;
                                    
                                    if (distance > 0) {
                                        coin.x += (dx / distance) * overlap * 0.5;
                                        coin.y += (dy / distance) * overlap * 0.5;
                                        other.x -= (dx / distance) * overlap * 0.5;
                                        other.y -= (dy / distance) * overlap * 0.5;
                                    }
                                    
                                    coin.xChange += Math.cos(angle) * 1.5;
                                    coin.yChange += Math.sin(angle) * 1.5;
                                    other.xChange -= Math.cos(angle) * 1.5;
                                    other.yChange -= Math.sin(angle) * 1.5;
                                }
                            }
                        }
                    }
                }
                
                const platinumCoins = this.coins.filter(c => c.type === 'platinum eagle' && !coinsToRemove.has(c));
                if (platinumCoins.length >= 2) {
                    const coin1 = platinumCoins[0];
                    const coin2 = platinumCoins[1];
                    const newX = (coin1.x + coin2.x) / 2;
                    const newY = (coin1.y + coin2.y) / 2;
                    const megaCoin = new Coin('mega coin', newX, newY, this.nextId++);
                    megaCoin.xChange = (coin1.xChange + coin2.xChange) / 2;
                    megaCoin.yChange = (coin1.yChange + coin2.yChange) / 2;
                    
                    coinsToRemove.add(coin1);
                    coinsToRemove.add(coin2);
                    coinsToAdd.push(megaCoin);
                    
                    this.megaCoinsCount++;
                    document.getElementById('megaCount').textContent = this.megaCoinsCount;
                    setTimeout(() => {
                        const index = this.coins.indexOf(megaCoin);
                        if (index > -1) this.coins.splice(index, 1);
                    }, 2000);
                }
                
                this.coins = this.coins.filter(c => !coinsToRemove.has(c));
                this.coins.push(...coinsToAdd);
            }
            
            checkGameOver() {
                const topThreshold = 150;
                let coinAtTop = false;
                
                for (const coin of this.coins) {
                    if (coin.y >= topThreshold) {
                        coinAtTop = true;
                        break;
                    }
                }
                
                if (coinAtTop && !this.topWarningTimer && !this.gameOver) {
                    this.topWarningTimer = setTimeout(() => {
                        let stillAtTop = false;
                        for (const coin of this.coins) {
                            if (coin.y >= topThreshold) {
                                stillAtTop = true;
                                break;
                            }
                        }
                        if (stillAtTop) {
                            this.gameOver = true;
                            document.getElementById('gameOver').classList.add('show');
                            canvas.style.cursor = 'default';
                        }
                        this.topWarningTimer = null;
                    }, 1000);
                } else if (!coinAtTop && this.topWarningTimer) {
                    clearTimeout(this.topWarningTimer);
                    this.topWarningTimer = null;
                }
            }
            
            animate() {
                if (this.gameOver) {
                    ctx.fillStyle = '#87CEEB';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    this.coins.forEach(coin => coin.draw());
                    return;
                }
                
                this.coins.forEach(coin => coin.update());
                this.checkCollisions();
                this.checkGameOver();
                
                ctx.fillStyle = '#87CEEB';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                this.coins.forEach(coin => coin.draw());
                
                requestAnimationFrame(() => this.animate());
            }
            updateDisplay(){
                spinner1.style.cursor = 'wait';
                document.getElementById('3').classList.remove('highlight');
                document.getElementById('2').classList.remove('highlight');
                document.getElementById('1').classList.remove('highlight');
                document.getElementById('score').innerText = this.score;
            if (game.nextCoin == 'dime') {
                document.getElementById('1').classList.add('highlight');
            }
            if(this.nextCoin == 'cent') {
                document.getElementById('2').classList.add('highlight');
            }
            if(this.nextCoin == 'silver eagle') {
                document.getElementById('3').classList.add('highlight');
            }
            if (this.highscore != undefined){
                spinner1.classList.add('hidden');
                document.getElementById('max').innerText = this.highscore;
                spinner1.style.cursor = 'default';
            }
            if (this.bbAvail >= 250) {
                document.getElementById('bankBonus').classList.remove('hidden');
            } else if (this.ubAvail >= 350){
                document.getElementById('upgradeBonus').classList.remove('hidden');
            }
        };
    }
        // Start the game
        let game = new CoinSimulator();
        setInterval(function(){game.updateDisplay()},1); 
        setInterval(function(){game.checkGameOver()},10);
        setInterval(() => {
            game.highscore = game.megaCoinsCount;
        }, 1000);
        window.addEventListener("beforeunload", function(event) {
            if(game.gameOver == false){
            var confirmationMessage = "Are you sure exit the game?";
            (event || window.event).returnValue = confirmationMessage; 
            return confirmationMessage;
            }
        });
    </script>
</body>
</html>
